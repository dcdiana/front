
<div class="load-earlier-answers" (click)="load()" *ngIf="moreData">
  Load earlier
</div>

<minds-card-answer *ngFor="#answer of answers; #i = index" [object]="answer" [parent]="parent" (delete)="delete(i)" (saved)="edited(i, $event)" ></minds-card-answer>

<div class="mdl-card minds-answer minds-comment-post minds-block">

    <div class="minds-avatar">
      <a [routerLink]="['/Channel', {username: session.getLoggedInUser().username }]">
        <img src="{{minds.cdn_url}}/icon/{{session.getLoggedInUser().guid}}/small" class="mdl-shadow--2dp"/>
      </a>
    </div>

    <div class="minds-body">

        <div class="m-answer-composer">
            <form (submit)="post()">

                <textarea
                  ngControl="message"
                  type="text"
                  id="message"
                  #message
                  [(ngModel)]="content"
                  (keyup)="getPostPreview(message)"
                  placeholder="Enter your answer"
                  (keydown.enter)="post($event)"
                  [autoGrow]
                  (click)="isLoggedIn()"
                  [disabled]="inProgress && attachment.hasFile()"
                ></textarea>
            </form>

            <div class="minds-answer-span mdl-color-text--red-500" *ngIf="!canPost && triedToPost">
              Please wait until the upload is complete.
            </div>

            <div class="mdl-card__actions">
              <!-- Attachements -->
              <div class="attachment-button" [ngClass]="{ 'mdl-color-text--amber-500': attachment.hasFile() }">
                <i class="material-icons">attachment</i>
                <input type="file" id="file" #file name="attachment" (change)="uploadAttachment(file, $event)"/>
              </div>

              <a class="m-mature-button"
              [ngClass]="{ 'mdl-color-text--red-500': attachment.isMature() }"
              (click)="attachment.toggleMature()"
              title="Explicit content"
              >
                <i class="material-icons">explicit</i>
              </a>
            </div>

            <!-- Rich embed preview -->
            <div class="post-preview" *ngIf="attachment.isRich()">
              <div class="mdl-spinner mdl-js-spinner is-active" [mdl] [hidden]="attachment.getMeta().title"></div>
              <div class="m-rich-embed mdl-shadow--2dp cf" *ngIf="attachment.getMeta().title">

                <a class="thumbnail" *ngIf="attachment.getMeta().thumbnail">
                  <img src="{{ attachment.getMeta().thumbnail }}" />
                </a>
                <a class="meta mdl-color-text--blue-grey-900" [ngClass]="{ 'm-has-thumbnail': attachment.getMeta().thumbnail }">
                  <h2 class="mdl-card__title-text">{{attachment.getMeta().title}}</h2>
                  <p>{{attachment.getMeta().description}}</p>
                </a>
              </div>
            </div>

            <!-- Attachment preview -->
            <div class="post-preview" *ngIf="attachment.hasFile() || attachment.getUploadProgress() > 0"  (click)="removeAttachment(file)">
              <div class="mdl-progress mdl-js-progress"
                [mdlUpload]
                [progress]="attachment.getUploadProgress()"
                [hidden]="attachment.getUploadProgress() == 0"
                [ngClass]="{ 'complete': attachment.getUploadProgress()  == 100 }"
                ></div>
              <div *ngIf="attachment.getMime() == 'video'" class="attachment-preview video-placeholder mdl-color--blue-grey-600">
                  <i class="material-icons">videocam</i>
              </div>
              <img *ngIf="attachment.getMime() != 'video'" [src]="attachment.getPreview()" class="attachment-preview mdl-shadow--2dp"/>
              <div class="attachment-preview-delete">
                <i class="material-icons">delete</i>
              </div>
            </div>
        </div>

    </div>

</div>

<m-modal-signup-on-action [open]="showModal" (closed)="showModal = false" action="answer"></m-modal-signup-on-action>
